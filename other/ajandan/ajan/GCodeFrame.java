/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package ajan;

import static ajan.ajanframe.gecerliproje;
import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 *
 * @author ajanuser
 */
public class GCodeFrame extends javax.swing.JDialog {

    /**
     * Creates new form GCodeFrame
     */
    public GCodeFrame() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        gcode = new javax.swing.JTextField();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setUndecorated(true);

        jButton1.setText("ADD");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jButton2.setText("Cancel");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jButton2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(jButton1))
                    .addComponent(gcode, javax.swing.GroupLayout.PREFERRED_SIZE, 270, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(gcode, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButton1)
                    .addComponent(jButton2))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents
int index=0;
ArrayList<DxfEssi> olusanVectorler = new java.util.ArrayList<>();
double x=0,y=0,xstart=0,ystart=0,xend=0,yend=0;
double g_code=1;boolean ciz=false;
int yon=0;
double x1;double y1;double z1;double z2;
double x2;double y2;double ip;double jp;
double posx;
double posy;
long posxb,posyb;
int centerX,centerY;//,Scale=2;
double ShiftX=0,ShiftY=0;
int CX,CY,MX,MY,mxb=0,myb=0;
boolean cizimde=false;
double Scale=.02;
double scala=2;
int MouseShiftStX=0,MouseShiftStY=0,ZWindowStX=0,ZWindowStY=0;
int satirsayisi=0;


private ArrayList<DxfEssi> vectoryap(String str)
{
//ciz=false;
DxfEssi cevir= new DxfEssi();
if(str.length()>1){
        String kod="";
        boolean girdi=false,pipe=false;
        Pattern p = Pattern.compile("([AXYZUFGIJKMH][+-]?[0-9]*\\.?[0-9]*\\,?[0-9]*)",Pattern.CASE_INSENSITIVE);
         Matcher m = p.matcher(str);

         while(m.find())
            {
            kod=m.group(1);

            if(kod.length()>0){x1=x2;y1=y2;
            if(kod.startsWith("A")||kod.startsWith("a")){pipe=true;ciz=true;yend=Double.parseDouble( kod.substring(1).replace(",", "."));yend=Math.PI*ajanframe.AjanMachine.PipeDiameter*yend/360;}
            if(kod.startsWith("X")||kod.startsWith("x")){ciz=true;xend=Double.parseDouble( kod.substring(1).replace(",", "."));/*if(kod.indexOf("-")>=0)xend=xend*-1;*/}
            if(kod.startsWith("Y")||kod.startsWith("y")){ciz=true;yend=Double.parseDouble(kod.substring(1).replace(",", "."));/*if(kod.indexOf("-")>=0)yend=yend*-1;*/}
            if(kod.startsWith("I")||kod.startsWith("i")){ip=Double.parseDouble(kod.substring(1).replace(",", "."));/*if(kod.indexOf("-")>=0)ip=ip*-1;*/}
            if(kod.startsWith("J")||kod.startsWith("j")){jp=Double.parseDouble(kod.substring(1).replace(",", "."));/*if(kod.indexOf("-")>=0)jp=jp*-1;*/}
            
            
            if(kod.startsWith("G")||kod.startsWith("g")){g_code=Double.parseDouble(kod.replaceAll("\\D+",""));
                if(g_code==0)yon=1;if(g_code==1)yon=1;else if(g_code==2)yon=2;else if(g_code==3)yon=3;
            }
            }
            girdi=true;
            }
                            
        if(girdi){
            //posx=x1=xw+(xstart*100 *Scale);posy=y1=yw-(ystart*100*Scale) ;x2=xw+(xend*100*Scale) ;y2=yw-(yend*100*Scale);
            posx=x1=xstart;
            posy=y1=ystart; 
            cevir.oge.indx=(int)g_code;
            cevir.oge.xn1=0*(1+24.4*ajanframe.MetricInc);
            cevir.oge.yn1=0*(1+24.4*ajanframe.MetricInc);
            cevir.oge.xn2=x2=xend*100*(1+24.4*ajanframe.MetricInc);
            cevir.oge.yn2=y2=yend*100*(1+24.4*ajanframe.MetricInc);
            if(pipe){
                cevir.oge.ac=cevir.oge.yc;
                cevir.oge.an1=cevir.oge.yn1;
                cevir.oge.an2=cevir.oge.yn2/100;
//            cevir.oge.yc=cevir.oge.yn1=cevir.oge.yn2=0;
            cevir.Flags.PipeCutEnable=true;
            
            }
        //drawLineAnime(x1,y1,x2,y2,linenumber);
       // shape sp=new shape(x1,y1,0.,x2,y2,0.,3000.);
        
        //conturlar.add(new shape(x1,y1,0.,x2,y2,0.,3000.));
        ystart=yend;xstart=xend;  
        }


}

olusanVectorler.add(cevir);
return olusanVectorler;
}



    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:
        //gecerliproje.kesimdosyasiCikar(ProjectFilesList.getSelectedIndex());
        
        gecerliproje.GCodeEkle(index,gcode.getText(),vectoryap(gcode.getText()));
        //gecerliproje.setdosyalistesi(ProjectFilesList);
            gecerliproje.listele();
            //vektortazele();
this.dispose();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        // TODO add your handling code here:
dispose();
    }//GEN-LAST:event_jButton2ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(GCodeFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(GCodeFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(GCodeFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(GCodeFrame.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new GCodeFrame().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField gcode;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    // End of variables declaration//GEN-END:variables
}
